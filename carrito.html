<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards</title>

    <!-- En lugar de Flowbite, utiliza Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

    <!-- Iconos -->
    <link href='https://unpkg.com/css.gg@2.0.0/icons/css/instagram.css' rel='stylesheet'>
    <link href="./dist/output.css" rel="stylesheet">
</head>

<body class="bg-gray-100"> <!-- Clase de fondo de Tailwind CSS -->


    <div class="about container mx-auto p-4 md:p-8">
        <h1 class="text-4xl font-bold mb-4">Carrito de compra</h1>
        <p class="mb-6">Items en el carrito = {{ store.itemsTotal }}</p>
        <section class="overflow-x-auto">
            <form action="" @submit.prevent="handleSale">
                <table class="min-w-full bg-white border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="py-2 px-2 md:px-4">Id</th>
                            <th class="py-2 px-2 md:px-4">Cantidad</th>
                            <th class="py-2 px-2 md:px-4">Precio</th>
                            <th class="py-2 px-2 md:px-4">Eliminar</th>
                        </tr>
                    </thead>
                    <tbody v-if="store.count.length">
                        <tr v-for="p in store.count" :key="p.producto_id">
                            <td class="py-2 px-2 md:px-4">{{ p.producto_id }}</td>
                            <td class="py-2 px-2 md:px-4"><input type="number" v-model="p.cantidad" class="w-16 border border-gray-300 p-2"></td>
                            <td class="py-2 px-2 md:px-4">{{ p.precio }}</td>
                            <td class="py-2 px-2 md:px-4">
                                <button @click="remove(item); redCost(p)" class="text-red-500 hover:text-red-700">Quitar</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <h3 class="productosC mt-6 text-xl md:text-2xl font-semibold">Costo total: {{ store.costoTotal }}Bs</h3>
                <input type="submit" value="Enviar" class="mt-4 px-4 md:px-6 py-2 bg-purple-600 text-white rounded-full hover:bg-purple-700">
            </form>
        </section>
    </div>
    
    

    <script setup>
        import { ref } from 'vue';
        import { store } from './store';
        const prods = ref([]);

        const handleSale = () => {
            //console.log(store.count);
            const data = ref({
                fecha: new Date().toLocaleString(),
                detalle: store.count
            })
            //console.log(JSON.stringify(data));
            fetch("http://localhost:3000/ventas", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data.value)
            })
        }
        const remove = (item) => {
            store.count.splice(store.count.indexOf(item), 1);
        }
        const redCost = (o) => {
            store.reduceCT(o)
        }
    </script>

    <style>
        .tiposC {
            display: flex;
            flex-direction: row;
        }

        .productosC {
            margin-right: 20px;
            padding-right: 20px;
        }
    </style>

</body>

</html>